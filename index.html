<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

    <title>Tasty</title>
    <link rel="stylesheet" href="lib/bootstrap-4.0.0-dist/css/bootstrap.min.css">
    <link href="lib/city-picker.css" rel="stylesheet">
    <link href="lib/index.css" rel="stylesheet">
</head>

<body>
    <div class="contenner">
        <div class="logo">
            <div class="name">Tasty</div>
            <!-- <div class="img logo_rotate">
                <img src="img/logo.png" alt="">
            </div> -->
            <div class="descript">
                <h3>酒香不怕巷子深</h3>
                <h5>Good wine needs no bush</h5>
                <h6>基于星云链的城市冷门美食搜集点！</h6>
            </div>
        </div>
        <div class="noExtension hide" id="noExtension">
            NOTE: Please install <a target="_blank" href="https://github.com/ChengOrangeJu/WebExtensionWallet">WebExtensionWallet</a>            to use SUPER DICTIONARY
        </div>
        <div class="row justify-content-center align-items-center">
            <div class="col-12 col-sm-10 col-md-6" style="position: relative;">
                <!-- container -->
                <input readonly type="text" data-toggle="city-picker" style="width:100%;">
            </div>
            <div class="col-4 col-sm-2 col-md-6 align-self-center">
                <button type="button" class="search_btn btn btn-light btn-lg" id=search>搜 巷 子</button>
            </div>
        </div>
        <div class="row">
            <div>
                <input id="search_value" type="text">
            </div>
        </div>
        <div class="result_success hide">
            <div id=search_banner></div>
            <p id=search_result> wait for content </p>
            <div class="author">
                <i><p> Author:</p> <p id=search_result_author> dasdajkajksdhjasdkjahdkjad</p></i>
            </div>
        </div>

        <div class="result_faile hide">
            Failed to find related information. Do you want to <button id="add">add</button> infromation for "<i id="result_faile_add">asd</i>"?
        </div>

        <div class="add_banner hide">
            <input type="text" id="add_value" placeholder="input contents for your keyword">
            <button id="push">submit</button>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <p>要使用 Tasty ,需使用Chrome浏览器并安装Nebulas钱包插件扩展</p>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">我是手机用户，我不想安装插件</button>
            <button type="button" class="btn btn-primary">我是PC用户，带我去安装插件</button>
            </div>
        </div>
        </div>
    </div>
    <footer class="coding">
        <img class="coding-img" src="img/coding.png">
    </footer>
    <script src=lib/jquery-3.3.1.min.js></script>
    <script src=lib/nebPay.js></script>
    <script src=lib/bootstrap-4.0.0-dist/js/bootstrap.min.js></script>
    <script src=lib/city-picker.data.min.js></script>
    <script src=lib/city-picker.min.js></script>
    <script src=lib/nebAction.js></script>
    <!-- <script>
        var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
        var nebPay = new NebPay();

        $("#search_value").attr("disabled", true)
        $("#search").attr("disabled", true)


        //to check if the extension is installed
        //if the extension is installed, var "webExtensionWallet" will be injected in to web page
        if (typeof (webExtensionWallet) === "undefined") {
            //alert ("Extension wallet is not installed, please install it first.")
            $("#noExtension").removeClass("hide")
        } else {
            $("#search_value").attr("disabled", false)
            $("#search").attr("disabled", false)
        }

        var dappAddress = "n1fwkf7AgDvYDt8JM1q59W4DE7R6jokQTLE";

        // 搜索功能: 查找Super-Dictionary 中有没有该词条
        $("#search").click(function () {
            // $("#search_value").val() 搜索框内的值

            var to = dappAddress;
            var value = "0";
            var callFunction = "get";
            var callArgs = "[\"" + $("#search_value").val() + "\"]"; //in the form of ["args"]
            nebPay.simulateCall(to, value, callFunction, callArgs, {    //使用nebpay的simulateCall接口去执行get查询, 模拟执行.不发送交易,不上链
                listener: cbSearch      //指定回调函数
            });
        })

        //return of search,
        function cbSearch(resp) {
            var result = resp.result
            console.log("return of rpc call: " + JSON.stringify(result))

            if (result === 'null') {
                $(".add_banner").addClass("hide");
                $(".result_success").addClass("hide");

                $("#result_faile_add").text($("#search_value").val())

                $(".result_faile").removeClass("hide");
            } else {
                //if result is not null, then it should be "return value" or "error message"
                try {
                    result = JSON.parse(result)
                } catch (err) {
                    //result is the error message
                }

                if (!!result.key) {      //"return value"
                    $(".add_banner").addClass("hide");
                    $(".result_faile").addClass("hide");

                    $("#search_banner").text($("#search_value").val())
                    $("#search_result").text(result.value)
                    $("#search_result_author").text(result.author)

                    $(".result_success").removeClass("hide");
                } else {        //"error message"
                    $(".add_banner").addClass("hide");
                    $(".result_faile").addClass("hide");

                    $("#search_banner").text($("#search_value").val())
                    $("#search_result").text(result)
                    $("#search_result_author").text("")

                    $(".result_success").removeClass("hide");
                }

            }

        }

        // 添加信息功能: 像super-dictionary 中添加词条
        $("#add").click(function () {
            $(".result_faile").addClass("hide");
            $(".add_banner").removeClass("hide");

            $("#add_value").val("")
        })

        $("#push").click(function () {

            var to = dappAddress;
            var value = "0";
            var callFunction = "save"
            var callArgs = "[\"" + $("#search_value").val() + "\",\"" + $("#add_value").val() + "\"]"

            nebPay.call(to, value, callFunction, callArgs, {    //使用nebpay的call接口去调用合约,
                listener: cbPush
            });
        });

        function cbPush(resp) {
            console.log("response of push: " + resp)
        }

    </script> -->
</body>

</html>